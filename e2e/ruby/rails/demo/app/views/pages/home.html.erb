<h1>LaunchDarkly Ruby Observability Demo</h1>

<h2>LaunchDarkly Feature Flags</h2>
<p>
  Connected to LaunchDarkly. Each flag evaluation creates an OpenTelemetry span.
</p>

<p>
  <strong>Status:</strong> <%= @flags_valid ? '✓ Connected' : '✗ Not connected' %><br>
  <strong>Total flags:</strong> <%= @flag_count %><br>
  <strong>Context key:</strong> <code><%= @context.key %></code>
</p>

<% if @sample_evaluations.any? %>
  <h3>Sample Flag Values</h3>
  <table border="1" cellpadding="8" cellspacing="0">
    <thead>
      <tr>
        <th>Flag Key</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <% @sample_evaluations.each do |key, value| %>
        <tr>
          <td><code><%= key %></code></td>
          <td><code><%= value.inspect %></code></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p><em>No flags available. Make sure LAUNCHDARKLY_SDK_KEY is set.</em></p>
<% end %>

<p>
  <a href="/flags">View all flags &rarr;</a>
</p>

<h2>Controller HTTP Request</h2>
<p>
  <%= @data %>
</p>

<h2>Traces</h2>

<%= turbo_frame_tag "trace_frame" do %>
  <%= button_to 'Create Trace', traces_path, method: :post, data: { turbo_frame: "trace_frame" } %>
<% end %>

<%# should update this to allow sending a custom project ID value from a form input %>
<%= turbo_frame_tag "trace_frame_2" do %>
  <%= button_to 'Create Trace for Project 2', custom_project_id_traces_path, method: :post, data: { turbo_frame: "trace_frame_2" } %>
<% end %>

<h2>Logs</h2>

<%# similar to above, create a button that sends a post reqest to /logs %>
<%= turbo_frame_tag "log_frame" do %>
  <%= button_to 'Create Log', logs_path, method: :post, data: { turbo_frame: "log_frame" } %>
  <%= button_to 'Create Log with Hash', create_with_hash_logs_path, method: :post, data: { turbo_frame: "log_frame" } %>
<% end %>

<h2>Errors</h2>

<%# similar to above, create a button that sends a post reqest to /errors %>
<%= turbo_frame_tag "error_frame" do %>
  <%= button_to 'Create Error', errors_path, method: :post, data: { turbo_frame: "error_frame" } %>
<% end %>
